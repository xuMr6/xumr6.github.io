<!DOCTYPE html>
<html>
<meta  lang="en" >
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#fff" id="theme-color">
  <link rel="icon" href="/img/1.jpg">
  <title>Mr xu</title>
  
  
  <meta property="og:title" content="nginx简介">
  
  
  <meta property="og:url" content="https://github.com/xuMr6/xumr6.github.io.git/2019/02/23/nginx%E7%AE%80%E4%BB%8B/index.html">
  
  
  <meta property="og:img" content="/img/1.jpg">
  
  
  
  <meta property="og:type" content="article">
  <meta property="og:article:published_time" content="2019-02-23">
  <meta property="og:article:modified_time" content="2020-09-11">
  <meta property="og:article:author" content="Mr xu">
  
  
  <meta property="og:article:tag" content="python">
  
  
  
  
  <script>
    // control reverse button
    var reverseDarkList = {
      dark: 'light',
      light: 'dark'
    };
    var themeColor = {
      dark: '#1c1c1e',
      light: '#fff'
    }
    // get the data of css prefers-color-scheme
    var getCssMediaQuery = function() {
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };
    // reverse current darkmode setting function
    var reverseDarkModeSetting = function() {
      var setting = localStorage.getItem('user-color-scheme');
      if(reverseDarkList[setting]) {
        setting = reverseDarkList[setting];
      } else if(setting === null) {
        setting = reverseDarkList[getCssMediaQuery()];
      } else {
        return;
      }
      localStorage.setItem('user-color-scheme', setting);
      return setting;
    };
    // apply current darkmode setting
    var setDarkmode = function(mode) {
      var setting = mode || localStorage.getItem('user-color-scheme');
      if(setting === getCssMediaQuery()) {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[setting];
      } else if(reverseDarkList[setting]) {
        document.documentElement.setAttribute('data-user-color-scheme', setting);
        document.getElementById('theme-color').content = themeColor[setting];
      } else {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[getCssMediaQuery()];
      }
    };
    setDarkmode();
  </script>
  <script>
    function loadScript(url, cb) {
      var script = document.createElement('script');
      script.src = url;
      if (cb) script.onload = cb;
      script.async = true;
      document.body.appendChild(script);
    }
  </script>
  
  <link rel="preload" href="//at.alicdn.com/t/font_1946621_f7g5jnuftcf.css" as="style" >
  <link rel="preload" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css" as="style" >
  
  <link rel="preload" href="//cdn.jsdelivr.net/npm/fslightbox@3.1.0/index.min.js" as="script">
  
  
  <link rel="preload" href="/js/lib/lozad.min.js" as="script">
  
  
  
  
  
  
  
  
<link rel="stylesheet" href="/css/main.css">

  
  
<link rel="stylesheet" href="//at.alicdn.com/t/font_1946621_f7g5jnuftcf.css">

  
  
<link rel="stylesheet" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css">

  
  
  
<meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/atom.xml" title="XuMr" type="application/atom+xml">
</head>


<body>
  <div class="wrapper">
    
    <nav class="navbar">
  <div class="navbar-logo">
    <span class="navbar-logo-main">
      
      <img class="navbar-logo-img" src="/img/1.jpg">
      
      <span class="navbar-logo-dsc">Mr xu</span>
    </span>
  </div>
  <div class="navbar-menu">
    
    <a href="/" class="navbar-menu-item">
    
    首页
    
    </a>
    
    <a href="/archives" class="navbar-menu-item">
    
    时间
    
    </a>
    
    <a href="/tags" class="navbar-menu-item">
    
    标签
    
    </a>
    
    <a href="/categories" class="navbar-menu-item">
    
    分类
    
    </a>
    
    <a class="navbar-menu-item darknavbar" id="dark"><i class="iconfont icon-weather"></i></a>
    <a class="navbar-menu-item searchnavbar" id="search"><i class="iconfont icon-search" style="font-size: 1.2rem; font-weight: 400;"></i></a>
  </div>
</nav>
    
    <div id="local-search" style="display: none;">
      <input class="navbar-menu-item" id="search-input" placeholder="请输入搜索内容...">
      <div id="search-content"></div>
    </div>
    
    <div class="section-wrap">
      <div class="container">
        <div class="columns">
          <main class="main-column">
<article class="card card-content">
  <header>
    <h1 class="post-title">
      nginx简介
    </h1>
  </header>
  <div class="post-meta post-show-meta">
    <time datetime="2019-02-23T04:20:00.000Z" style="display: flex; align-items: center;">
      <i class="iconfont icon-calendar" style="margin-right: 2px;"></i>
      <span>2019-02-23</span>
    </time>
    
    <span class="dot"></span>
    
    <a href="/categories/nginx/" class="post-meta-link">nginx</a>
    
    
    
    <span class="dot"></span>
    <span>5.6k words</span>
    
  </div>
  
  <div class="post-meta post-show-meta" style="margin-top: -10px;">
    <div style="display: flex; align-items: center;">
      <i class="iconfont icon-biaoqian" style="margin-right: 2px; font-size: 1.15rem;"></i>
      
      
        <a href="/tags/python/" class="post-meta-link">python</a>
      
    </div>
  </div>
  
  </header>
  <div id="section" class="post-content">
    <h1 id="1-nginx-功能介绍"><a href="#1-nginx-功能介绍" class="headerlink" title="1. nginx 功能介绍"></a>1. nginx 功能介绍</h1><p>Nginx因为它的稳定性、丰富的模块库、灵活的配置和低系统资源的消耗而闻名．业界一致认为它是Apache2.2＋mod_proxy_balancer的轻量级代替者，不仅是因为响应静态页面的速度非常快，而且它的模块数量达到Apache的近2/3。对proxy和rewrite模块的支持很彻底，还支持mod_fcgi、ssl、vhosts ，适合用来做mongrel clusters的前端HTTP响应。<br>nginx和Apache一样使用模块化设计，nginx模块包括内置模块和第三方模块，其中内置模块中包含主模块和事件模块。</p>
<p>nginx处理请求逻辑图<br><img src="https://img-blog.csdnimg.cn/20190511170603322.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc3ODY3,size_16,color_FFFFFF,t_70"></p>
<h1 id="2-nginx可以提供的服务"><a href="#2-nginx可以提供的服务" class="headerlink" title="2. nginx可以提供的服务"></a>2. nginx可以提供的服务</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. web 服务.</span><br><span class="line">2. 负载均衡 （反向代理）</span><br><span class="line">3. web cache（web 缓存）</span><br></pre></td></tr></table></figure>
<h1 id="3-nginx-的优点"><a href="#3-nginx-的优点" class="headerlink" title="3. nginx 的优点"></a>3. nginx 的优点</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. 高并发。静态小文件</span><br><span class="line">2. 占用资源少。2万并发、10个线程，内存消耗几百M。</span><br><span class="line">3. 功能种类比较多。web,cache,proxy。每一个功能都不是特别强。</span><br><span class="line">4. 支持epoll模型，使得nginx可以支持高并发。</span><br><span class="line">5. nginx 配合动态服务和Apache有区别。（FASTCGI 接口）</span><br><span class="line">6. 利用nginx可以对IP限速，可以限制连接数。</span><br><span class="line">7. 配置简单，更灵活。</span><br></pre></td></tr></table></figure>

<h1 id="4-nginx应用场合"><a href="#4-nginx应用场合" class="headerlink" title="4. nginx应用场合"></a>4. nginx应用场合</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 静态服务器。（图片，视频服务）另一个lighttpd。并发几万，html，js，css，flv，jpg，gif等。</span><br><span class="line">2. 动态服务，nginx——fastcgi 的方式运行PHP，jsp。（PHP并发在500-1500，MySQL 并发在300-1500）。</span><br><span class="line">3. 反向代理，负载均衡。日pv2000W以下，都可以直接用nginx做代理。</span><br><span class="line">4. 缓存服务。类似 SQUID,VARNISH。</span><br></pre></td></tr></table></figure>
<h1 id="5-主流web服务产品对比说明"><a href="#5-主流web服务产品对比说明" class="headerlink" title="5. 主流web服务产品对比说明"></a>5. 主流web服务产品对比说明</h1><h2 id="5-1-Apache-特性"><a href="#5-1-Apache-特性" class="headerlink" title="5.1 Apache-特性"></a>5.1 Apache-特性</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. 2.2版本本身稳定强大，据官方说：其2.4版本性能更强。</span><br><span class="line">2. prefork模式取消了进程创建开销，性能很高。</span><br><span class="line">3. 处理动态业务数据时，因关联到后端的引擎和数据库，瓶颈不在与Apache本身。</span><br><span class="line">4. 高并发时消耗系统资源相对多一些。</span><br><span class="line">5. 基于传统的select模型。</span><br><span class="line">6. 扩展库，DSO方法。</span><br></pre></td></tr></table></figure>
<h2 id="5-2-nginx-特性"><a href="#5-2-nginx-特性" class="headerlink" title="5.2 nginx-特性"></a>5.2 nginx-特性</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. 基于异步IO模型，（epoll，kqueue），性能强，能够支持上万并发。</span><br><span class="line">2. 对小文件支持很好，性能很高（限静态小文件1M）。</span><br><span class="line">3. 代码优美，扩展库必须编译进主程序。</span><br><span class="line">4. 消耗代码资源比较低。</span><br><span class="line">5.  ighttpd（百度贴吧，豆瓣）</span><br><span class="line">6. 基于异步IO模式，性能和nginx相近。</span><br><span class="line">7. 扩展库是SO模式，比nginx要灵活。</span><br><span class="line">8. 通过差距（mod_secdownload）可实现文件URL地址加密。</span><br></pre></td></tr></table></figure>
<h2 id="5-3-web服务产品性能对比测试"><a href="#5-3-web服务产品性能对比测试" class="headerlink" title="5.3 web服务产品性能对比测试"></a>5.3 web服务产品性能对比测试</h2><h3 id="5-3-1-静态数据性能对比"><a href="#5-3-1-静态数据性能对比" class="headerlink" title="5.3.1 静态数据性能对比"></a>5.3.1 静态数据性能对比</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 处理静态文件Apache性能比nginx和lighttpd要差。</span><br><span class="line">2. nginx在处理小文件优势明显。</span><br><span class="line">3. 处理静态小文件（小于1M），nginx和lighttpd比Apache更有优势，lighttpd最强。</span><br></pre></td></tr></table></figure>
<h3 id="5-3-2-动态数据性能对比"><a href="#5-3-2-动态数据性能对比" class="headerlink" title="5.3.2 动态数据性能对比"></a>5.3.2 动态数据性能对比</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 处理动态内容三者相差不大，主要取决于PHP和数据库的压力。</span><br><span class="line">2. 当处理动态数据时，三者差距不大，从测试结果看，Apache更有优势一点。这是因为处理动态数据能力取决于PHP和后端数据的提供服务能力。也就是说瓶颈不在web服务器上。</span><br><span class="line">3. 一般PHP引擎支持的并发参考值300-1000，JAVA引擎并发300-1000，数据库的并发300-1000.</span><br></pre></td></tr></table></figure>
<h3 id="5-3-3-为什么nginx的总体性能比Apache高。"><a href="#5-3-3-为什么nginx的总体性能比Apache高。" class="headerlink" title="5.3.3 为什么nginx的总体性能比Apache高。"></a>5.3.3 为什么nginx的总体性能比Apache高。</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. nginx使用最新的epoll和kqueue网络IO模型，而Apache使用床头的select模式。</span><br><span class="line">2. 目前Linux下能够承受高并发访问的squid、Memcached 都采用的是epoll网络IO模型。</span><br></pre></td></tr></table></figure>

<h3 id="5-3-4-如何选择WEB服务器"><a href="#5-3-4-如何选择WEB服务器" class="headerlink" title="5.3.4 如何选择WEB服务器"></a>5.3.4 如何选择WEB服务器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">静态业务：高并发、采用nginx，lighttpd，根据自己的掌握程度或公司的要求。</span><br><span class="line">动态业务：采用nginx和Apache均可。</span><br><span class="line">既有静态业务又有动态业务：nginx或Apache，不要多选要单选。</span><br><span class="line">动态业务可以由前端代理（haproxy）,根据页面元素的类型，向后转发相应的服务器进行处理。</span><br><span class="line">思想：我们工作都不要追求一步到位，满足需求的前提下，先用，然后逐步完善。</span><br><span class="line">提示：nginx做web（Apache，lighttpd）、反向代理（haproxy,lvs,nat）及缓存服务器（squid）也是不错的。</span><br><span class="line">最终建议：对外的业务nginx，对内的业务Apache（yum httpd mysql-server php）。</span><br></pre></td></tr></table></figure>

<h1 id="6-nginx实战过程"><a href="#6-nginx实战过程" class="headerlink" title="6. nginx实战过程"></a>6. nginx实战过程</h1><h2 id="6-1-安装依赖包"><a href="#6-1-安装依赖包" class="headerlink" title="6.1 安装依赖包"></a>6.1 安装依赖包</h2><ul>
<li>nginx安装依赖GCC、openssl-devel、pcre-devel和zlib-devel软件库。</li>
<li>Pcre全称（Perl Compatible Regular Expressions），中文perl兼容正则表达式，<a target="_blank" rel="noopener" href="http://www.pcre.org/">pcre官方站点</a>。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install  pcre pcre-devel -y </span><br><span class="line">yum install openssl openssl-devel -y </span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="6-2-开始编译"><a href="#6-2-开始编译" class="headerlink" title="6.2 开始编译"></a>6.2 开始编译</h2><p>使用**./configure –help<strong>查看各个模块的使用情况，使用</strong>–without-http_ssi_module<strong>的方式关闭不需要的模块。可以使用</strong>–with-http_perl_modules**方式安装需要的模块。</p>
<h3 id="6-2-1-编译命令"><a href="#6-2-1-编译命令" class="headerlink" title="6.2.1 编译命令"></a>6.2.1 编译命令</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tar -zxf nginx<span class="number">-1.10</span><span class="number">.1</span>.tar.gz </span><br><span class="line">cd nginx<span class="number">-1.10</span><span class="number">.1</span>/</span><br><span class="line">./configure --prefix=/data/nginx<span class="number">-1.10</span><span class="number">.1</span> --user=nginx --group=nginx  --<span class="keyword">with</span>-http_ssl_module  --<span class="keyword">with</span>-http_stub_status_module</span><br><span class="line"></span><br><span class="line">useradd nginx -M -s /sbin/nologin </span><br><span class="line">make &amp;&amp; make install </span><br><span class="line">ln -s /data/nginx<span class="number">-1.10</span><span class="number">.1</span> /data/nginx</span><br></pre></td></tr></table></figure>
<h3 id="6-2-2-测试nginx配置文件是否正常"><a href="#6-2-2-测试nginx配置文件是否正常" class="headerlink" title="6.2.2 测试nginx配置文件是否正常"></a>6.2.2 测试nginx配置文件是否正常</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/data/nginx/sbin/nginx -t </span><br><span class="line">nginx: the configuration file /data/nginx<span class="number">-1.10</span><span class="number">.1</span>/conf/nginx.conf syntax <span class="keyword">is</span> ok</span><br><span class="line">nginx: configuration file /data/nginx<span class="number">-1.10</span><span class="number">.1</span>/conf/nginx.conf test <span class="keyword">is</span> successful</span><br></pre></td></tr></table></figure>
<h3 id="6-2-3-启动nginx服务器"><a href="#6-2-3-启动nginx服务器" class="headerlink" title="6.2.3 启动nginx服务器"></a>6.2.3 启动nginx服务器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/data/nginx/sbin/nginx  -t  <span class="comment">##检查配置文件</span></span><br><span class="line">/data/nginx/sbin/nginx      <span class="comment">##确定nginx服务</span></span><br><span class="line">netstat -lntup |grep nginx      <span class="comment">## 检查进程是否正常</span></span><br><span class="line">curl http://localhost           <span class="comment">## 确认结果</span></span><br></pre></td></tr></table></figure>
<h3 id="6-2-4-nginx其他命令"><a href="#6-2-4-nginx其他命令" class="headerlink" title="6.2.4 nginx其他命令"></a>6.2.4 nginx其他命令</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nginx -s signal</span><br><span class="line">signal：</span><br><span class="line">stop — fast shutdown</span><br><span class="line">quit — graceful shutdown</span><br><span class="line">reload — reloading the configuration file</span><br><span class="line">reopen — reopening the log files</span><br><span class="line">用来打开日志文件，这样nginx会把新日志信息写入这个新的文件中</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>/data/nginx/sbin/nginx -V</strong> 查看已经编译的参数。</p>
<p>使用kill命令操作nginx。格式：<em>kill -信号 PID</em></p>
<p>信号名称</p>
<ul>
<li>TERM,INT 快速关闭</li>
<li>QUIT 优雅的关闭，保持吸纳有的客户端连接</li>
<li>HUP 重启应用新的配置文件</li>
<li>USR1 重新打开日志文件</li>
<li>USR2 升级程序</li>
<li>WINCH 优雅的关闭工作进程</li>
</ul>
<p><strong>例子：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kill -QUIT  &#96;cat &#x2F;data&#x2F;nginx&#x2F;nginx.pid&#96;</span><br><span class="line">kill -HUP &#96;cat &#x2F;data&#x2F;nginx&#x2F;nginx.pid&#96;</span><br></pre></td></tr></table></figure>

<h1 id="7-nginx配置文件"><a href="#7-nginx配置文件" class="headerlink" title="7. nginx配置文件"></a>7. nginx配置文件</h1><p><strong>配置基础配置文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application&#x2F;octet-stream;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">        error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">        location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">### 测试配置文件是否正常</span><br><span class="line">shell&gt; &#x2F;data&#x2F;nginx&#x2F;sbin&#x2F;nginx -t </span><br><span class="line">nginx: the configuration file &#x2F;data&#x2F;nginx-1.10.3&#x2F;conf&#x2F;nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file &#x2F;data&#x2F;nginx-1.10.3&#x2F;conf&#x2F;nginx.conf test is successful</span><br><span class="line">shell&gt; curl -I http:&#x2F;&#x2F;localhost</span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br></pre></td></tr></table></figure>
<h1 id="8-nginx监控"><a href="#8-nginx监控" class="headerlink" title="8. nginx监控"></a>8. nginx监控</h1><p><strong>开启nginx的监控服务</strong></p>
<h2 id="8-1-开启状态页"><a href="#8-1-开启状态页" class="headerlink" title="8.1 开启状态页"></a>8.1 开启状态页</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设定查看Nginx状态的地址   </span></span><br><span class="line">location /status &#123;  </span><br><span class="line">  stub_status on;   	<span class="comment">#表示开启stubStatus的工作状态统计功能。</span></span><br><span class="line">  access_log off;   	<span class="comment">#access_log off; 关闭access_log 日志记录功能。</span></span><br><span class="line">  <span class="comment">#auth_basic &quot;status&quot;;   							#auth_basic 是nginx的一种认证机制。</span></span><br><span class="line">  <span class="comment">#auth_basic_user_file conf/htpasswd;	#用来指定密码文件的位置。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="8-2-配置登录密码"><a href="#8-2-配置登录密码" class="headerlink" title="8.2 配置登录密码"></a>8.2 配置登录密码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y httpd-tools</span><br><span class="line">/usr/local/apache/bin/htpasswd -c /data/nginx/conf/htpasswd biglittleant </span><br><span class="line">New password:</span><br></pre></td></tr></table></figure>
<p><strong>完成后会在/*data/nginx/conf/*目录下生成htpasswd文件。</strong></p>
<h2 id="8-3-访问URL"><a href="#8-3-访问URL" class="headerlink" title="8.3 访问URL"></a>8.3 访问URL</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/status</span><br><span class="line"></span><br><span class="line">Active connections:  <span class="number">1</span></span><br><span class="line">server accepts handled requests</span><br><span class="line"> <span class="number">16</span> <span class="number">16</span> <span class="number">18</span></span><br><span class="line">Reading: <span class="number">0</span> Writing: <span class="number">1</span> Waiting: <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#active connections – 活跃的连接数量</span></span><br><span class="line"><span class="comment">#server accepts handled requests — 总共处理了16个连接 , 成功创建16次握手, 总共处理了18个请求</span></span><br><span class="line"><span class="comment">#Reading — 读取客户端的连接数: Writing 响应数据到客户端的数量; Waiting 开启 keep-alive 的情况下,这个值等于 active – (reading+writing), 意思就是 Nginx 已经处理完正在等候下一次请求指令的驻留连接.</span></span><br></pre></td></tr></table></figure>
<h2 id="8-4-编写zabbix监控脚本"><a href="#8-4-编写zabbix监控脚本" class="headerlink" title="8.4 编写zabbix监控脚本"></a>8.4 编写zabbix监控脚本</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">nginx_status_fun()&#123;</span><br><span class="line">    NGINX_PORT=$<span class="number">1</span></span><br><span class="line">    NGINX_COMMAND=$<span class="number">2</span></span><br><span class="line">    nginx_active()&#123;</span><br><span class="line">        /usr/bin/curl <span class="string">&quot;http://127.0.0.1:&quot;</span>$NGINX_PORT<span class="string">&quot;/status/&quot;</span> <span class="number">2</span>&gt;/dev/null| grep <span class="string">&#x27;Active&#x27;</span> | awk <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    nginx_reading()&#123;</span><br><span class="line">        /usr/bin/curl <span class="string">&quot;http://127.0.0.1:&quot;</span>$NGINX_PORT<span class="string">&quot;/status/&quot;</span> <span class="number">2</span>&gt;/dev/null| grep <span class="string">&#x27;Reading&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span></span><br><span class="line">       &#125;</span><br><span class="line">    nginx_writing()&#123;</span><br><span class="line">        /usr/bin/curl <span class="string">&quot;http://127.0.0.1:&quot;</span>$NGINX_PORT<span class="string">&quot;/status/&quot;</span> <span class="number">2</span>&gt;/dev/null| grep <span class="string">&#x27;Writing&#x27;</span> | awk <span class="string">&#x27;&#123;print $4&#125;&#x27;</span></span><br><span class="line">       &#125;</span><br><span class="line">    nginx_waiting()&#123;</span><br><span class="line">        /usr/bin/curl <span class="string">&quot;http://127.0.0.1:&quot;</span>$NGINX_PORT<span class="string">&quot;/status/&quot;</span> <span class="number">2</span>&gt;/dev/null| grep <span class="string">&#x27;Waiting&#x27;</span> | awk <span class="string">&#x27;&#123;print $6&#125;&#x27;</span></span><br><span class="line">       &#125;</span><br><span class="line">    nginx_accepts()&#123;</span><br><span class="line">        /usr/bin/curl <span class="string">&quot;http://127.0.0.1:&quot;</span>$NGINX_PORT<span class="string">&quot;/status/&quot;</span> <span class="number">2</span>&gt;/dev/null| awk NR==<span class="number">3</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span></span><br><span class="line">       &#125;</span><br><span class="line">    nginx_handled()&#123;</span><br><span class="line">        /usr/bin/curl <span class="string">&quot;http://127.0.0.1:&quot;</span>$NGINX_PORT<span class="string">&quot;/status/&quot;</span> <span class="number">2</span>&gt;/dev/null| awk NR==<span class="number">3</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span></span><br><span class="line">       &#125;</span><br><span class="line">    nginx_requests()&#123;</span><br><span class="line">        /usr/bin/curl <span class="string">&quot;http://127.0.0.1:&quot;</span>$NGINX_PORT<span class="string">&quot;/status/&quot;</span> <span class="number">2</span>&gt;/dev/null| awk NR==<span class="number">3</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span></span><br><span class="line">       &#125;</span><br><span class="line">    case $NGINX_COMMAND <span class="keyword">in</span></span><br><span class="line">        active)</span><br><span class="line">            nginx_active;</span><br><span class="line">            ;;</span><br><span class="line">        reading)</span><br><span class="line">            nginx_reading;</span><br><span class="line">            ;;</span><br><span class="line">        writing)</span><br><span class="line">            nginx_writing;</span><br><span class="line">            ;;</span><br><span class="line">        waiting)</span><br><span class="line">            nginx_waiting;</span><br><span class="line">            ;;</span><br><span class="line">        accepts)</span><br><span class="line">            nginx_accepts;</span><br><span class="line">            ;;</span><br><span class="line">        handled)</span><br><span class="line">            nginx_handled;</span><br><span class="line">            ;;</span><br><span class="line">        requests)</span><br><span class="line">            nginx_requests;</span><br><span class="line">        esac </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="9-nginx优化"><a href="#9-nginx优化" class="headerlink" title="9. nginx优化"></a>9. nginx优化</h1><h2 id="9-1-nginx内核优化"><a href="#9-1-nginx内核优化" class="headerlink" title="9.1 nginx内核优化"></a>9.1 nginx内核优化</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.tcp_fin_timeout = <span class="number">2</span></span><br><span class="line">net.ipv4.tcp_tw_reuse = <span class="number">1</span></span><br><span class="line">net.ipv4.tcp_tw_recycle = <span class="number">1</span></span><br><span class="line">net.ipv4.tcp_syncookies = <span class="number">1</span></span><br><span class="line">net.ipv4.tcp_keepalive_time = <span class="number">600</span></span><br><span class="line">net.ipv4.ip_local_port_range = <span class="number">4000</span>    <span class="number">65000</span></span><br><span class="line">net.ipv4.tcp_max_syn_backlog = <span class="number">16384</span></span><br><span class="line">net.ipv4.tcp_max_tw_buckets = <span class="number">36000</span></span><br><span class="line">net.ipv4.route.gc_timeout = <span class="number">100</span></span><br><span class="line">net.ipv4.tcp_syn_retries = <span class="number">1</span></span><br><span class="line">net.ipv4.tcp_synack_retries = <span class="number">1</span></span><br><span class="line">net.core.somaxconn = <span class="number">16384</span></span><br><span class="line">net.core.netdev_max_backlog = <span class="number">16384</span></span><br><span class="line">net.ipv4.tcp_max_orphans = <span class="number">16384</span></span><br><span class="line"><span class="comment">#以下参数是对iptables防火墙的优化，防火墙不开会提示，可以忽略不理。</span></span><br><span class="line">net.ipv4.ip_conntrack_max = <span class="number">25000000</span></span><br><span class="line">net.ipv4.netfilter.ip_conntrack_max=<span class="number">25000000</span></span><br><span class="line">net.ipv4.netfilter.ip_conntrack_tcp_timeout_established=<span class="number">180</span></span><br><span class="line">net.ipv4.netfilter.ip_conntrack_tcp_timeout_time_wait=<span class="number">120</span></span><br><span class="line">net.ipv4.netfilter.ip_conntrack_tcp_timeout_close_wait=<span class="number">60</span></span><br><span class="line">net.ipv4.netfilter.ip_conntrack_tcp_timeout_fin_wait=<span class="number">120</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="10-扩展一："><a href="#10-扩展一：" class="headerlink" title="10. 扩展一："></a>10. 扩展一：</h1><h2 id="10-1-nginx全局变量"><a href="#10-1-nginx全局变量" class="headerlink" title="10.1  nginx全局变量"></a>10.1  nginx全局变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$args：这个变量等于请求行中的参数，同$query_string。</span><br><span class="line">$is_args: 如果已经设置$args，则该变量的值为&quot;?&quot;，否则为&quot;&quot;。</span><br><span class="line">$content_length： 请求头中的Content-length字段。</span><br><span class="line">$content_type： 请求头中的Content-Type字段。</span><br><span class="line">$document_uri： 与$uri相同。</span><br><span class="line">$document_root： 当前请求在root指令中指定的值。</span><br><span class="line">$host： 请求主机头字段，否则为服务器名称。</span><br><span class="line">$http_user_agent： 客户端agent信息。</span><br><span class="line">$http_cookie： 客户端cookie信息。</span><br><span class="line">$limit_rate： 这个变量可以限制连接速率。</span><br><span class="line">$request_method： 客户端请求的动作，通常为GET或POST。</span><br><span class="line">$remote_addr： 客户端的IP地址。</span><br><span class="line">$remote_port： 客户端的端口。</span><br><span class="line">$remote_user： 已经经过Auth Basic Module验证的用户名。</span><br><span class="line">$request_body_file&#96;: 客户端请求主体的临时文件名。</span><br><span class="line">$request_uri: 请求的URI，带参数</span><br><span class="line">$request_filename： 当前请求的文件路径，由root或alias指令与URI请求生成。</span><br><span class="line">$scheme： 所用的协议，比如http或者是https，比如rewrite ^(.+)$ $scheme:&#x2F;&#x2F;example.com$1 redirect;。</span><br><span class="line">$server_protocol： 请求使用的协议，通常是HTTP&#x2F;1.0或HTTP&#x2F;1.1。</span><br><span class="line">$server_addr： 服务器地址，在完成一次系统调用后可以确定这个值。</span><br><span class="line">$server_name： 服务器名称。</span><br><span class="line">$server_port： 请求到达服务器的端口号。</span><br><span class="line">$request_uri： 包含请求参数的原始URI，不包含主机名，如：&#x2F;foo&#x2F;bar.php?arg&#x3D;baz，它无法修改。</span><br><span class="line">$uri： 不带请求参数的当前URI，$uri不包含主机名，如&#x2F;foo&#x2F;bar.html可能和最初的值有不同，比如经过重定向之类的。它可以通过内部重定向，或者使用index指令进行修改。不包括协议和主机名，例如&#x2F;foo&#x2F;bar.html。</span><br></pre></td></tr></table></figure>

<p><strong>例子：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">访问链接是：http://localhost:<span class="number">88</span>/test1/test.php </span><br><span class="line">网站路径是：/var/www/html</span><br><span class="line"></span><br><span class="line">$host：localhost</span><br><span class="line">$server_port：<span class="number">88</span></span><br><span class="line">$request_uri：http://localhost:<span class="number">88</span>/test1/test.php</span><br><span class="line">$document_uri：/test1/test.php</span><br><span class="line">$document_root：/var/www/html</span><br><span class="line">$request_filename：/var/www/html/test1/test.php</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>nginx plus – ngx_http_status_module</strong></p>
<p>商业版的 nginx plus 通过他的 ngx_http_status_module 提供了比 nginx 更多的监控指标，可以参看 <a target="_blank" rel="noopener" href="http://demo.nginx.com/status.html">http://demo.nginx.com/status.html</a></p>
<p><strong>nginx access log 分析</strong><br>nginx 的 access log 中可以记录很多有价值的信息，通过分析 access log，可以收集到很多指标。<br>python 编写的 linux 工具 ngxtop 就实现了对 access log 的分析功能。</p>
<p><strong>NDK – ngx_devel_kit</strong><br>NDK 是一个拓展nginx服务器核心功能的模块，第三方模块开发可以基于它来快速实现。NDK提供函数和宏处理一些基本任务，减轻第三方模块开发的代码量。</p>
<p><strong>nginx lua – lua-nginx-module</strong><br>nginx的lua模块，通过这个模块，可以对nginx做定制开发</p>
<h2 id="10-2-web服务器事件处理模型"><a href="#10-2-web服务器事件处理模型" class="headerlink" title="10.2  web服务器事件处理模型"></a>10.2  web服务器事件处理模型</h2><p><strong>select</strong><br>select最早于1983年出现在4.2BSD中，它通过一个select()系统调用来监视多个文件描述符的数组，当select()返回后，该数组中就绪的文件描述符便会被内核修改标志位，使得进程可以获得这些文件描述符从而进行后续的读写操作。<br>select目前几乎在所有的平台上支持，其良好跨平台支持也是它的一个优点，事实上从现在看来，这也是它所剩不多的优点之一。<br>select的一个缺点在于单个进程能够监视的文件描述符的数量存在最大限制，在Linux上一般为1024，不过可以通过修改宏定义甚至重新编译内核的方式提升这一限制。<br>另外，select()所维护的存储大量文件描述符的数据结构，随着文件描述符数量的增大，其复制的开销也线性增长。同时，由于网络响应时间的延迟使得大量TCP连接处于非活跃状态，但调用select()会对所有socket进行一次线性扫描，所以这也浪费了一定的开销。</p>
<p><strong>poll</strong><br>poll在1986年诞生于System V Release 3，它和select在本质上没有多大差别，但是poll没有最大文件描述符数量的限制。<br>poll和select同样存在一个缺点就是，包含大量文件描述符的数组被整体复制于用户态和内核的地址空间之间，而不论这些文件描述符是否就绪，它的开销随着文件描述符数量的增加而线性增大。<br>另外，select()和poll()将就绪的文件描述符告诉进程后，如果进程没有对其进行IO操作，那么下次调用select()和poll()的时候将再次报告这些文件描述符，所以它们一般不会丢失就绪的消息，这种方式称为水平触发（Level Triggered）。</p>
<p><strong>epoll</strong><br>直到Linux2.6才出现了由内核直接支持的实现方法，那就是epoll，它几乎具备了之前所说的一切优点，被公认为Linux2.6下性能最好的多路I/O就绪通知方法。<br>epoll可以同时支持水平触发和边缘触发（Edge Triggered，只告诉进程哪些文件描述符刚刚变为就绪状态，它只说一遍，如果我们没有采取行动，那么它将不会再次告知，这种方式称为边缘触发），理论上边缘触发的性能要更高一些，但是代码实现相当复杂。<br>epoll同样只告知那些就绪的文件描述符，而且当我们调用epoll_wait()获得就绪文件描述符时，返回的不是实际的描述符，而是一个代表就绪描述符数量的值，你只需要去epoll指定的一个数组中依次取得相应数量的文件描述符即可，这里也使用了内存映射（mmap）技术，这样便彻底省掉了这些文件描述符在系统调用时复制的开销。<br>另一个本质的改进在于epoll采用基于事件的就绪通知方式。在select/poll中，进程只有在调用一定的方法后，内核才对所有监视的文件描述符进行扫描，而epoll事先通过epoll_ctl()来注册一个文件描述符，一旦基于某个文件描述符就绪时，内核会采用类似callback的回调机制，迅速激活这个文件描述符，当进程调用epoll_wait()时便得到通知。</p>
<p><strong>nginx -s reload 过程</strong><br>nginx主进程读取配置文件，如果发现配置文件变更，会创建一个新的主进程，然后同时旧的进程，及旧的子进程关闭，旧进程会拒绝新的连接，服务到自己的连接结束，然后关闭。</p>
<p><strong>Apache select模型和 nginx epoll 模型对比讲解</strong></p>
<p>Nginx的高并发得益于其采用了epoll模型，与传统的服务器程序架构不同，epoll是linux内核2.6以后才出现的。下面通过比较Apache和Nginx工作原理来比较。</p>
<p>传统Apache都是多进程或者多线程来工作，假设是多进程工作（prefork），apache会先生成几个进程，类似进程池的工作原理，只不过这里的进程池会随着请求数目的增加而增加。对于每一个连接，apache都是在一个进程内处理完毕。具体是 recv（），以及根据 URI 去进行磁盘I/O来寻找文件，还有 send（）都是阻塞的。其实说白了都是 apche 对于套接字的I/O，读或者写，但是读或者写都是阻塞的，阻塞意味着进程就得挂起进入sleep状态，那么一旦连接数很多，Apache必然要生成更多的进程来响应请求，一旦进程多了，CPU对于进程的切换就频繁了，很耗资源和时间，所以就导致apache性能下降了，说白了就是处理不过来这么多进程了。其实仔细想想，如果对于进程每个请求都没有阻塞，那么效率肯定会提高很多。</p>
<p>Nginx采用epoll模型，异步非阻塞。对于Nginx来说，把一个完整的连接请求处理都划分成了事件，一个一个的事件。比如accept（）， recv（），磁盘I/O，send（）等，每部分都有相应的模块去处理，一个完整的请求可能是由几百个模块去处理。真正核心的就是事件收集和分发模块，这就是管理所有模块的核心。只有核心模块的调度才能让对应的模块占用CPU资源，从而处理请求。拿一个HTTP请求来说，首先在事件收集分发模块注册感兴趣的监听事件，注册好之后不阻塞直接返回，接下来就不需要再管了，等待有连接来了内核会通知你(epoll的轮询会告诉进程)，cpu就可以处理其他事情去了。一旦有请求来，那么对整个请求分配相应的上下文（其实已经预先分配好），这时候再注册新的感兴趣的事件(read函数)，同样客户端数据来了内核会自动通知进程可以去读数据了，读了数据之后就是解析，解析完后去磁盘找资源（I/O），一旦I/O完成会通知进程，进程开始给客户端发回数据send()，这时候也不是阻塞的，调用后就等内核发回通知发送的结果就行。整个下来把一个请求分成了很多个阶段，每个阶段都到很多模块去注册，然后处理，都是异步非阻塞。异步这里指的就是做一个事情，不需要等返回结果，做好了会自动通知你。</p>
<p><strong>select/epoll的特点</strong></p>
<p><strong>select的特点</strong>：select 选择句柄的时候，是遍历所有句柄，也就是说句柄有事件响应时，select需要遍历所有句柄才能获取到哪些句柄有事件通知，因此效率是非常低。但是如果连接很少的情况下， select和epoll的LT触发模式相比， 性能上差别不大。<br>这里要多说一句，select支持的句柄数是有限制的， 同时只支持1024个，这个是句柄集合限制的，如果超过这个限制，很可能导致溢出，而且非常不容易发现问题， 当然可以通过修改linux的socket内核调整这个参数。<br><strong>epoll的特点</strong>：epoll对于句柄事件的选择不是遍历的，是事件响应的，就是句柄上事件来就马上选择出来，不需要遍历整个句柄链表，因此效率非常高，内核将句柄用红黑树保存的。<br>对于epoll而言还有ET和LT的区别，LT表示水平触发，ET表示边缘触发，两者在性能以及代码实现上差别也是非常大的。</p>
<p>不管是Nginx还是Squid这种反向代理，其网络模式都是事件驱动。事件驱动其实是很老的技术，早期的select、poll都是如此。后来基于内核通知的更高级事件机制出现，如libevent里的epoll，使事件驱动性能得以提高。事件驱动的本质还是IO事件，应用程序在多个IO句柄间快速切换，实现所谓的异步IO。事件驱动服务器，最适合做的就是这种IO密集型工作，如反向代理，它在客户端与WEB服务器之间起一个数据中转作用，纯粹是IO操作，自身并不涉及到复杂计算。反向代理用事件驱动来做，显然更好，一个工作进程就可以run了，没有进程、线程管理的开销，CPU、内存消耗都小。</p>
<p>所以Nginx、Squid都是这样做的。当然，Nginx也可以是多进程 + 事件驱动的模式，几个进程跑libevent，不需要Apache那样动辄数百的进程数。Nginx处理静态文件效果也很好，那是因为静态文件本身也是磁盘IO操作，处理过程一样。至于说多少万的并发连接，这个毫无意义。随手写个网络程序都能处理几万的并发，但如果大部分客户端阻塞在那里，就没什么价值。</p>
<p>再看看Apache或者Resin这类应用服务器，之所以称他们为应用服务器，是因为他们真的要跑具体的业务应用，如科学计算、图形图像、数据库读写等。它们很可能是CPU密集型的服务，事件驱动并不合适。例如一个计算耗时2秒，那么这2秒就是完全阻塞的，什么event都没用。想想MySQL如果改成事件驱动会怎么样，一个大型的join或sort就会阻塞住所有客户端。这个时候多进程或线程就体现出优势，每个进程各干各的事，互不阻塞和干扰。当然，现代CPU越来越快，单个计算阻塞的时间可能很小，但只要有阻塞，事件编程就毫无优势。所以进程、线程这类技术，并不会消失，而是与事件机制相辅相成，长期存在。</p>
<p><strong>总言之，事件驱动适合于IO密集型服务，多进程或线程适合于CPU密集型服务，它们各有各的优势，并不存在谁取代谁的倾向。</strong></p>

  </div>
  <div>
  
  <div class="post-note note-warning copyright" style="margin-top: 42px">
    <p><span style="font-weight: bold;">作者：</span><a target="_blank" rel="nofollow noopener noreferrer" href="https://github.com/xuMr6/xumr6.github.io.git/about">Mr xu</a></p>
    <p><span style="font-weight: bold;">文章链接：</span><a target="_blank" rel="nofollow noopener noreferrer" href="https://github.com/xuMr6/xumr6.github.io.git/2019/02/23/nginx%E7%AE%80%E4%BB%8B/">https://github.com/xuMr6/xumr6.github.io.git/2019/02/23/nginx%E7%AE%80%E4%BB%8B/</a></p>
    <p><span style="font-weight: bold;">版权声明：</span>本博客所有文章除特别声明外，转载请注明出处！</p>
  </div>
  
  </div>
</article>
<div class="nav">
  
  <div class="nav-item-prev">
    <a href="/2019/03/01/Python常见基础算法题/" class="nav-link">
      <i class="iconfont icon-left nav-prev-icon"></i>
      <div>
        <div class="nav-label">Prev</div>
        
        <div class="nav-title">Python常见基础算法题 </div>
        
      </div>
    </a>
  </div>
  
  
  <div class="nav-item-next">
    <a href="/2019/02/14/Mysql锁/" class="nav-link">
      <div>
        <div class="nav-label">Next</div>
        
        <div class="nav-title">Mysql锁 </div>
        
      </div>
      <i class="iconfont icon-right nav-next-icon"></i>
    </a>
  </div>
  
</div>

<div class="card card-content toc-card" id="mobiletoc">
  <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>TOC</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-nginx-%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D"><span class="toc-text">1. nginx 功能介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-nginx%E5%8F%AF%E4%BB%A5%E6%8F%90%E4%BE%9B%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="toc-text">2. nginx可以提供的服务</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-nginx-%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-text">3. nginx 的优点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-nginx%E5%BA%94%E7%94%A8%E5%9C%BA%E5%90%88"><span class="toc-text">4. nginx应用场合</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E4%B8%BB%E6%B5%81web%E6%9C%8D%E5%8A%A1%E4%BA%A7%E5%93%81%E5%AF%B9%E6%AF%94%E8%AF%B4%E6%98%8E"><span class="toc-text">5. 主流web服务产品对比说明</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-Apache-%E7%89%B9%E6%80%A7"><span class="toc-text">5.1 Apache-特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-nginx-%E7%89%B9%E6%80%A7"><span class="toc-text">5.2 nginx-特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-web%E6%9C%8D%E5%8A%A1%E4%BA%A7%E5%93%81%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94%E6%B5%8B%E8%AF%95"><span class="toc-text">5.3 web服务产品性能对比测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-1-%E9%9D%99%E6%80%81%E6%95%B0%E6%8D%AE%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94"><span class="toc-text">5.3.1 静态数据性能对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-2-%E5%8A%A8%E6%80%81%E6%95%B0%E6%8D%AE%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94"><span class="toc-text">5.3.2 动态数据性能对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-3-%E4%B8%BA%E4%BB%80%E4%B9%88nginx%E7%9A%84%E6%80%BB%E4%BD%93%E6%80%A7%E8%83%BD%E6%AF%94Apache%E9%AB%98%E3%80%82"><span class="toc-text">5.3.3 为什么nginx的总体性能比Apache高。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-4-%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9WEB%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">5.3.4 如何选择WEB服务器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-nginx%E5%AE%9E%E6%88%98%E8%BF%87%E7%A8%8B"><span class="toc-text">6. nginx实战过程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E5%8C%85"><span class="toc-text">6.1 安装依赖包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E5%BC%80%E5%A7%8B%E7%BC%96%E8%AF%91"><span class="toc-text">6.2 开始编译</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-1-%E7%BC%96%E8%AF%91%E5%91%BD%E4%BB%A4"><span class="toc-text">6.2.1 编译命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-2-%E6%B5%8B%E8%AF%95nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8"><span class="toc-text">6.2.2 测试nginx配置文件是否正常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-3-%E5%90%AF%E5%8A%A8nginx%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">6.2.3 启动nginx服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-4-nginx%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-text">6.2.4 nginx其他命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">7. nginx配置文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-nginx%E7%9B%91%E6%8E%A7"><span class="toc-text">8. nginx监控</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E5%BC%80%E5%90%AF%E7%8A%B6%E6%80%81%E9%A1%B5"><span class="toc-text">8.1 开启状态页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E9%85%8D%E7%BD%AE%E7%99%BB%E5%BD%95%E5%AF%86%E7%A0%81"><span class="toc-text">8.2 配置登录密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-%E8%AE%BF%E9%97%AEURL"><span class="toc-text">8.3 访问URL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-%E7%BC%96%E5%86%99zabbix%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC"><span class="toc-text">8.4 编写zabbix监控脚本</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-nginx%E4%BC%98%E5%8C%96"><span class="toc-text">9. nginx优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-nginx%E5%86%85%E6%A0%B8%E4%BC%98%E5%8C%96"><span class="toc-text">9.1 nginx内核优化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E6%89%A9%E5%B1%95%E4%B8%80%EF%BC%9A"><span class="toc-text">10. 扩展一：</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-nginx%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="toc-text">10.1  nginx全局变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-web%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E6%A8%A1%E5%9E%8B"><span class="toc-text">10.2  web服务器事件处理模型</span></a></li></ol></li></ol>
</div></main>
          <aside class="left-column">
            
            <div class="card card-author">
              
<img src="/img/1.jpg" class="author-img">

<p class="author-name">Mr xu</p>
<p class="author-description"></p>
<div class="author-message">
  <a class="author-posts-count" href="/archives">
    <span>113</span>
    <span>Posts</span>
  </a>
  <a class="author-categories-count" href="/categories">
    <span>18</span>
    <span>Categories</span>
  </a>
  <a class="author-tags-count" href="/tags">
    <span>2</span>
    <span>Tags</span>
  </a>
</div>

            </div>
            
            <div class="sticky-tablet">
  
  
  <article class="display-when-two-columns spacer">
    <div class="card card-content toc-card">
      <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>TOC</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-nginx-%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D"><span class="toc-text">1. nginx 功能介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-nginx%E5%8F%AF%E4%BB%A5%E6%8F%90%E4%BE%9B%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="toc-text">2. nginx可以提供的服务</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-nginx-%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-text">3. nginx 的优点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-nginx%E5%BA%94%E7%94%A8%E5%9C%BA%E5%90%88"><span class="toc-text">4. nginx应用场合</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E4%B8%BB%E6%B5%81web%E6%9C%8D%E5%8A%A1%E4%BA%A7%E5%93%81%E5%AF%B9%E6%AF%94%E8%AF%B4%E6%98%8E"><span class="toc-text">5. 主流web服务产品对比说明</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-Apache-%E7%89%B9%E6%80%A7"><span class="toc-text">5.1 Apache-特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-nginx-%E7%89%B9%E6%80%A7"><span class="toc-text">5.2 nginx-特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-web%E6%9C%8D%E5%8A%A1%E4%BA%A7%E5%93%81%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94%E6%B5%8B%E8%AF%95"><span class="toc-text">5.3 web服务产品性能对比测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-1-%E9%9D%99%E6%80%81%E6%95%B0%E6%8D%AE%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94"><span class="toc-text">5.3.1 静态数据性能对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-2-%E5%8A%A8%E6%80%81%E6%95%B0%E6%8D%AE%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94"><span class="toc-text">5.3.2 动态数据性能对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-3-%E4%B8%BA%E4%BB%80%E4%B9%88nginx%E7%9A%84%E6%80%BB%E4%BD%93%E6%80%A7%E8%83%BD%E6%AF%94Apache%E9%AB%98%E3%80%82"><span class="toc-text">5.3.3 为什么nginx的总体性能比Apache高。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-4-%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9WEB%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">5.3.4 如何选择WEB服务器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-nginx%E5%AE%9E%E6%88%98%E8%BF%87%E7%A8%8B"><span class="toc-text">6. nginx实战过程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E5%8C%85"><span class="toc-text">6.1 安装依赖包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E5%BC%80%E5%A7%8B%E7%BC%96%E8%AF%91"><span class="toc-text">6.2 开始编译</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-1-%E7%BC%96%E8%AF%91%E5%91%BD%E4%BB%A4"><span class="toc-text">6.2.1 编译命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-2-%E6%B5%8B%E8%AF%95nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8"><span class="toc-text">6.2.2 测试nginx配置文件是否正常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-3-%E5%90%AF%E5%8A%A8nginx%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">6.2.3 启动nginx服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-4-nginx%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-text">6.2.4 nginx其他命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">7. nginx配置文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-nginx%E7%9B%91%E6%8E%A7"><span class="toc-text">8. nginx监控</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E5%BC%80%E5%90%AF%E7%8A%B6%E6%80%81%E9%A1%B5"><span class="toc-text">8.1 开启状态页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E9%85%8D%E7%BD%AE%E7%99%BB%E5%BD%95%E5%AF%86%E7%A0%81"><span class="toc-text">8.2 配置登录密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-%E8%AE%BF%E9%97%AEURL"><span class="toc-text">8.3 访问URL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-%E7%BC%96%E5%86%99zabbix%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC"><span class="toc-text">8.4 编写zabbix监控脚本</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-nginx%E4%BC%98%E5%8C%96"><span class="toc-text">9. nginx优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-nginx%E5%86%85%E6%A0%B8%E4%BC%98%E5%8C%96"><span class="toc-text">9.1 nginx内核优化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E6%89%A9%E5%B1%95%E4%B8%80%EF%BC%9A"><span class="toc-text">10. 扩展一：</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-nginx%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="toc-text">10.1  nginx全局变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-web%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E6%A8%A1%E5%9E%8B"><span class="toc-text">10.2  web服务器事件处理模型</span></a></li></ol></li></ol>
    </div>
  </article>
  
  
  <article class="card card-content categories-widget">
    <div class="categories-card">
  <div class="categories-header"><i class="iconfont icon-fenlei" style="padding-right: 2px;"></i>Categories</div>
  <div class="categories-list">
    
      <a href="/categories/celery">
        <div class="categories-list-item">
          celery
          <span class="categories-list-item-badge">3</span>
        </div>
      </a>
    
      <a href="/categories/docker">
        <div class="categories-list-item">
          docker
          <span class="categories-list-item-badge">4</span>
        </div>
      </a>
    
      <a href="/categories/djangobook">
        <div class="categories-list-item">
          djangobook
          <span class="categories-list-item-badge">22</span>
        </div>
      </a>
    
      <a href="/categories/django">
        <div class="categories-list-item">
          django
          <span class="categories-list-item-badge">22</span>
        </div>
      </a>
    
      <a href="/categories/ES检索">
        <div class="categories-list-item">
          ES检索
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/jwt">
        <div class="categories-list-item">
          jwt
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/linux">
        <div class="categories-list-item">
          linux
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/python">
        <div class="categories-list-item">
          python
          <span class="categories-list-item-badge">13</span>
        </div>
      </a>
    
      <a href="/categories/mysql">
        <div class="categories-list-item">
          mysql
          <span class="categories-list-item-badge">6</span>
        </div>
      </a>
    
      <a href="/categories/nginx">
        <div class="categories-list-item">
          nginx
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/支付宝扫码">
        <div class="categories-list-item">
          支付宝扫码
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/redis">
        <div class="categories-list-item">
          redis
          <span class="categories-list-item-badge">3</span>
        </div>
      </a>
    
      <a href="/categories/爬虫">
        <div class="categories-list-item">
          爬虫
          <span class="categories-list-item-badge">9</span>
        </div>
      </a>
    
      <a href="/categories/vue">
        <div class="categories-list-item">
          vue
          <span class="categories-list-item-badge">8</span>
        </div>
      </a>
    
      <a href="/categories/git">
        <div class="categories-list-item">
          git
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/mongodb">
        <div class="categories-list-item">
          mongodb
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/编程">
        <div class="categories-list-item">
          编程
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/算法">
        <div class="categories-list-item">
          算法
          <span class="categories-list-item-badge">3</span>
        </div>
      </a>
    
  </div>
</div>
  </article>
  
  <article class="card card-content tags-widget">
    <div class="tags-card">
  <div class="tags-header"><i class="iconfont icon-biaoqian" style="padding-right: 2px;"></i>hot tags</div>
  <div class="tags-list">
    
    <a href="\tags\python" title="python"><div class="tags-list-item">python</div></a>
    
    <a href="\tags\Linux" title="Linux"><div class="tags-list-item">Linux</div></a>
    
  </div>
</div>
  </article>
  
  
</div>
          </aside>
          <aside class="right-column">
            <div class="sticky-widescreen">
  
  
  <article class="card card-content toc-card">
    <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>TOC</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-nginx-%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D"><span class="toc-text">1. nginx 功能介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-nginx%E5%8F%AF%E4%BB%A5%E6%8F%90%E4%BE%9B%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="toc-text">2. nginx可以提供的服务</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-nginx-%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-text">3. nginx 的优点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-nginx%E5%BA%94%E7%94%A8%E5%9C%BA%E5%90%88"><span class="toc-text">4. nginx应用场合</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E4%B8%BB%E6%B5%81web%E6%9C%8D%E5%8A%A1%E4%BA%A7%E5%93%81%E5%AF%B9%E6%AF%94%E8%AF%B4%E6%98%8E"><span class="toc-text">5. 主流web服务产品对比说明</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-Apache-%E7%89%B9%E6%80%A7"><span class="toc-text">5.1 Apache-特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-nginx-%E7%89%B9%E6%80%A7"><span class="toc-text">5.2 nginx-特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-web%E6%9C%8D%E5%8A%A1%E4%BA%A7%E5%93%81%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94%E6%B5%8B%E8%AF%95"><span class="toc-text">5.3 web服务产品性能对比测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-1-%E9%9D%99%E6%80%81%E6%95%B0%E6%8D%AE%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94"><span class="toc-text">5.3.1 静态数据性能对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-2-%E5%8A%A8%E6%80%81%E6%95%B0%E6%8D%AE%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94"><span class="toc-text">5.3.2 动态数据性能对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-3-%E4%B8%BA%E4%BB%80%E4%B9%88nginx%E7%9A%84%E6%80%BB%E4%BD%93%E6%80%A7%E8%83%BD%E6%AF%94Apache%E9%AB%98%E3%80%82"><span class="toc-text">5.3.3 为什么nginx的总体性能比Apache高。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-4-%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9WEB%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">5.3.4 如何选择WEB服务器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-nginx%E5%AE%9E%E6%88%98%E8%BF%87%E7%A8%8B"><span class="toc-text">6. nginx实战过程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E5%8C%85"><span class="toc-text">6.1 安装依赖包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E5%BC%80%E5%A7%8B%E7%BC%96%E8%AF%91"><span class="toc-text">6.2 开始编译</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-1-%E7%BC%96%E8%AF%91%E5%91%BD%E4%BB%A4"><span class="toc-text">6.2.1 编译命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-2-%E6%B5%8B%E8%AF%95nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8"><span class="toc-text">6.2.2 测试nginx配置文件是否正常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-3-%E5%90%AF%E5%8A%A8nginx%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">6.2.3 启动nginx服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-4-nginx%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-text">6.2.4 nginx其他命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">7. nginx配置文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-nginx%E7%9B%91%E6%8E%A7"><span class="toc-text">8. nginx监控</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E5%BC%80%E5%90%AF%E7%8A%B6%E6%80%81%E9%A1%B5"><span class="toc-text">8.1 开启状态页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E9%85%8D%E7%BD%AE%E7%99%BB%E5%BD%95%E5%AF%86%E7%A0%81"><span class="toc-text">8.2 配置登录密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-%E8%AE%BF%E9%97%AEURL"><span class="toc-text">8.3 访问URL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-%E7%BC%96%E5%86%99zabbix%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC"><span class="toc-text">8.4 编写zabbix监控脚本</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-nginx%E4%BC%98%E5%8C%96"><span class="toc-text">9. nginx优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-nginx%E5%86%85%E6%A0%B8%E4%BC%98%E5%8C%96"><span class="toc-text">9.1 nginx内核优化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E6%89%A9%E5%B1%95%E4%B8%80%EF%BC%9A"><span class="toc-text">10. 扩展一：</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-nginx%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="toc-text">10.1  nginx全局变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-web%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E6%A8%A1%E5%9E%8B"><span class="toc-text">10.2  web服务器事件处理模型</span></a></li></ol></li></ol>
  </article>
  
  
  <article class="card card-content">
    <div class="recent-posts-card">
  <div class="recent-posts-header"><i class="iconfont icon-wenzhang_huaban" style="padding-right: 2px;"></i>Recent Posts</div>
  <div class="recent-posts-list">
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2020-09-06</div>
        <a href="/2020/09/06/Python基础知识点大全/"><div class="recent-posts-item-content">Python基础知识点大全</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2020-08-29</div>
        <a href="/2020/08/29/Django + uWSGI + Nginx 的生产环境部署，及WSGI &amp; uwsgi &amp; uWSGI 的作用/"><div class="recent-posts-item-content">Django + uWSGI + Nginx 的生产环境部署，及WSGI &amp; uwsgi &amp; uWSGI 的作用</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2020-08-27</div>
        <a href="/2020/08/27/Docker 的基本常用命令/"><div class="recent-posts-item-content">Docker 的基本常用命令</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2020-08-25</div>
        <a href="/2020/08/25/Docker 镜像 &amp; 容器和镜像的联系 读写层/"><div class="recent-posts-item-content">Docker 镜像 &amp; 容器和镜像的联系 读写层</div></a>
      </div>
    
  </div>
</div>
  </article>
  
  
</div>
          </aside>
        </div>
      </div>
    </div>
  </div>
  
  <footer class="footer">
  <div class="footer-container">
    <div>
      <div class="footer-dsc">
        <span>Copyright ©
          
          2020 -
          
          2020
        </span>
        &nbsp;
        <a href="/" class="footer-link">Mr xu </a>
      </div>
    </div>

    
    <div class="footer-dsc">
      
      Powered by
      <a href="https://hexo.io/" class="footer-link" target="_blank" rel="nofollow noopener noreferrer">&nbsp;Hexo </a>
      
      
      <span>&nbsp;|&nbsp;</span>
      
      
      Theme -
      <a href="https://github.com/theme-kaze" class="footer-link" target="_blank"
        rel="nofollow noopener noreferrer">&nbsp;Kaze</a>
      
    </div>
    
    
    
    
</footer>
  <a role="button" id="scrollbutton" class="basebutton" >
  <i class="iconfont icon-arrowleft button-icon"></i>
</a>
<a role="button" id="menubutton" class="basebutton">
  <i class="iconfont icon-menu button-icon"></i>
</a>
<a role="button" id="popbutton" class="basebutton">
  <i class="iconfont icon-expand button-icon"></i>
</a>
<a role="button" id="darkbutton" class="basebutton darkwidget">
  <i class="iconfont icon-weather button-icon"></i>
</a>
<a role="button" id="searchbutton" class="basebutton searchwidget">
  <i class="iconfont icon-search button-icon"></i>
</a>

  
  
  
  <script>
  var addImgLayout = function () {
    var img = document.querySelectorAll('.post-content img');
    var i;
    for (i = 0; i < img.length; i++) {
      var wrapper = document.createElement('a');
      wrapper.setAttribute('data-fslightbox', 'gallery');
      wrapper.setAttribute('href', img[i].getAttribute('data-src'));
      wrapper.style.cssText = 'width: 100%; display: flex; justify-content: center;';
      img[i].before(wrapper);
      wrapper.append(img[i]);
    }
    refreshFsLightbox();
  }
</script>
<script>loadScript("//cdn.jsdelivr.net/npm/fslightbox@3.1.0/index.min.js", addImgLayout)</script>
  
  
  
<script src="/js/main.js"></script>

  
  
  <script>
    var addLazyload = function () {
      var observer = lozad('.lozad', {
        load: function (el) {
          el.srcset = el.getAttribute('data-src');
        },
        loaded: function (el) {
          el.classList.add('loaded');
        }
      });
      observer.observe();
    }
  </script>
  <script>loadScript("/js/lib/lozad.min.js", addLazyload)</script>
  
  
</body>

</html>